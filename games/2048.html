<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 - ë¯¸ë‹ˆê²Œì„ ì²œêµ­</title>
    <link rel="stylesheet" href="../styles/game-common.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        #game-2048 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 16px;
            max-width: 500px;
            margin: 0 auto;
            aspect-ratio: 1;
        }

        .tile {
            aspect-ratio: 1;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 800;
            transition: all 0.15s ease;
            position: relative;
        }

        .tile[data-value="2"] {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .tile[data-value="4"] {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .tile[data-value="8"] {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .tile[data-value="16"] {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
        }

        .tile[data-value="32"] {
            background: linear-gradient(135deg, #fa709a, #fee140);
        }

        .tile[data-value="64"] {
            background: linear-gradient(135deg, #30cfd0, #330867);
        }

        .tile[data-value="128"] {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
        }

        .tile[data-value="256"] {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #333;
        }

        .tile[data-value="512"] {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #333;
        }

        .tile[data-value="1024"] {
            background: linear-gradient(135deg, #ff6e7f, #bfe9ff);
        }

        .tile[data-value="2048"] {
            background: linear-gradient(135deg, #e0c3fc, #8ec5fc);
            font-size: 2rem;
        }

        .tile.new {
            animation: pop 0.2s ease;
        }

        .tile.merged {
            animation: merge 0.2s ease;
        }

        @keyframes pop {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes merge {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .instructions {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 1rem;
            font-size: 0.95rem;
        }

        .instructions kbd {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            margin: 0 0.25rem;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <div class="game-header">
            <a href="../index.html" class="back-button">â† ë©”ì¸ìœ¼ë¡œ</a>
            <h1 class="game-title">ğŸ”¢ 2048</h1>
            <p class="game-description">íƒ€ì¼ì„ í•©ì³ 2048ì„ ë§Œë“œì„¸ìš”!</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">ì ìˆ˜</span>
                <div class="status-value" id="score">0</div>
            </div>
            <div class="status-item">
                <span class="status-label">ìµœê³  ì ìˆ˜</span>
                <div class="status-value" id="best-score">0</div>
            </div>
        </div>

        <div class="game-board">
            <div id="game-2048"></div>
            <div class="instructions">
                í‚¤ë³´ë“œ í™”ì‚´í‘œ <kbd>â†‘</kbd> <kbd>â†“</kbd> <kbd>â†</kbd> <kbd>â†’</kbd> ë˜ëŠ” ìŠ¤ì™€ì´í”„ë¡œ ì¡°ì‘
            </div>
        </div>

        <div class="controls">
            <button class="button" onclick="resetGame()">ìƒˆ ê²Œì„</button>
        </div>
    </div>

    <script>
        const GRID_SIZE = 4;
        let grid = [];
        let score = 0;
        let bestScore = localStorage.getItem('2048-best') || 0;
        let touchStartX, touchStartY;

        function initGame() {
            grid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(0));
            score = 0;
            addRandomTile();
            addRandomTile();
            updateUI();
        }

        function addRandomTile() {
            const emptyCells = [];
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j] === 0) emptyCells.push([i, j]);
                }
            }

            if (emptyCells.length > 0) {
                const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                grid[row][col] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function updateUI() {
            const boardElement = document.getElementById('game-2048');
            boardElement.innerHTML = '';

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    if (grid[i][j] !== 0) {
                        tile.textContent = grid[i][j];
                        tile.dataset.value = grid[i][j];
                    }
                    boardElement.appendChild(tile);
                }
            }

            document.getElementById('score').textContent = score;
            document.getElementById('best-score').textContent = bestScore;
        }

        function move(direction) {
            let moved = false;
            const newGrid = grid.map(row => [...row]);

            if (direction === 'left' || direction === 'right') {
                for (let i = 0; i < GRID_SIZE; i++) {
                    const row = direction === 'left' ? newGrid[i] : newGrid[i].reverse();
                    const merged = mergeLine(row);
                    if (direction === 'right') merged.reverse();
                    if (JSON.stringify(newGrid[i]) !== JSON.stringify(merged)) moved = true;
                    newGrid[i] = merged;
                }
            } else {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const col = newGrid.map(row => row[j]);
                    const line = direction === 'up' ? col : col.reverse();
                    const merged = mergeLine(line);
                    if (direction === 'down') merged.reverse();
                    for (let i = 0; i < GRID_SIZE; i++) {
                        if (newGrid[i][j] !== merged[i]) moved = true;
                        newGrid[i][j] = merged[i];
                    }
                }
            }

            if (moved) {
                grid = newGrid;
                addRandomTile();
                updateUI();

                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('2048-best', bestScore);
                }

                if (isGameOver()) {
                    setTimeout(() => alert('ê²Œì„ ì˜¤ë²„! ì ìˆ˜: ' + score), 200);
                }
            }
        }

        function mergeLine(line) {
            // Remove zeros
            let newLine = line.filter(val => val !== 0);

            // Merge adjacent equal values
            for (let i = 0; i < newLine.length - 1; i++) {
                if (newLine[i] === newLine[i + 1]) {
                    newLine[i] *= 2;
                    score += newLine[i];
                    newLine.splice(i + 1, 1);
                }
            }

            // Fill with zeros
            while (newLine.length < GRID_SIZE) {
                newLine.push(0);
            }

            return newLine;
        }

        function isGameOver() {
            // Check for empty cells
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j] === 0) return false;
                }
            }

            // Check for possible merges
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (j < GRID_SIZE - 1 && grid[i][j] === grid[i][j + 1]) return false;
                    if (i < GRID_SIZE - 1 && grid[i][j] === grid[i + 1][j]) return false;
                }
            }

            return true;
        }

        function resetGame() {
            initGame();
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                const direction = {
                    'ArrowUp': 'up',
                    'ArrowDown': 'down',
                    'ArrowLeft': 'left',
                    'ArrowRight': 'right'
                }[e.key];
                move(direction);
            }
        });

        // Touch controls
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            if (!touchStartX || !touchStartY) return;

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;

            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            if (Math.abs(dx) > Math.abs(dy)) {
                move(dx > 0 ? 'right' : 'left');
            } else {
                move(dy > 0 ? 'down' : 'up');
            }

            touchStartX = null;
            touchStartY = null;
        });

        // Initialize
        initGame();
    </script>
</body>

</html>